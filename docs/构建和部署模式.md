# Next.js æ„å»ºå’Œéƒ¨ç½²æ¨¡å¼è¯¦è§£

## ğŸ—ï¸ æ„å»ºè¾“å‡ºç»“æ„

### æ ‡å‡†æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
```bash
npm run build
```

**è¾“å‡ºç›®å½•ç»“æ„**ï¼š
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .next/                    # æ„å»ºè¾“å‡ºï¼ˆâš ï¸ ä¸è¦åˆ é™¤ï¼‰
â”‚   â”œâ”€â”€ cache/               # æ„å»ºç¼“å­˜
â”‚   â”œâ”€â”€ server/              # æœåŠ¡ç«¯ä»£ç 
â”‚   â”‚   â”œâ”€â”€ app/            # App Router é¡µé¢ï¼ˆSSR/SSGï¼‰
â”‚   â”‚   â”œâ”€â”€ pages/          # API Routes
â”‚   â”‚   â””â”€â”€ chunks/         # ä»£ç åˆ†å—
â”‚   â”œâ”€â”€ static/              # é™æ€èµ„æºï¼ˆJSã€CSSã€å­—ä½“ï¼‰
â”‚   â”‚   â”œâ”€â”€ chunks/         # JS ä»£ç å—
â”‚   â”‚   â”œâ”€â”€ css/            # CSS æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ media/          # å›¾ç‰‡ã€å­—ä½“ç­‰
â”‚   â””â”€â”€ trace                # æ€§èƒ½è¿½è¸ª
â”œâ”€â”€ public/                   # å…¬å…±é™æ€æ–‡ä»¶ï¼ˆåŸæ ·å¤åˆ¶ï¼‰
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ ...
â””â”€â”€ node_modules/             # ä¾èµ–åŒ…ï¼ˆâš ï¸ ç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼‰
```

**æ‰§è¡Œæ–¹å¼**ï¼š
```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨ npm script
npm start

# æ–¹å¼ 2ï¼šç›´æ¥è¿è¡Œ Node.js
node node_modules/next/dist/bin/next start

# æ–¹å¼ 3ï¼šæŒ‡å®šç«¯å£
PORT=8080 npm start
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ„å»ºå¿«é€Ÿ
- âœ… æ”¯æŒæ‰€æœ‰ Next.js ç‰¹æ€§

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦å®Œæ•´çš„ `node_modules`ï¼ˆä½“ç§¯å¤§ï¼‰
- âŒ ä¸é€‚åˆ Docker éƒ¨ç½²ï¼ˆé•œåƒä½“ç§¯å¤§ï¼‰

---

## ğŸ“¦ ç‹¬ç«‹æ¨¡å¼ï¼ˆStandaloneï¼Œç”Ÿäº§æ¨èï¼‰

### é…ç½®æ–¹å¼
ä¿®æ”¹ `next.config.js`ï¼š
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  output: 'standalone',  // å¯ç”¨ç‹¬ç«‹æ¨¡å¼
};

module.exports = nextConfig;
```

### æ„å»ºè¾“å‡º
```bash
npm run build
```

**è¾“å‡ºç›®å½•ç»“æ„**ï¼š
```
.next/
â”œâ”€â”€ standalone/              # â­ å®Œæ•´çš„ç‹¬ç«‹åº”ç”¨
â”‚   â”œâ”€â”€ server.js           # â­ å¯åŠ¨å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json        # æœ€å°åŒ–ä¾èµ–åˆ—è¡¨
â”‚   â”œâ”€â”€ node_modules/       # ä»…åŒ…å«å¿…éœ€çš„ä¾èµ–ï¼ˆç²¾ç®€ï¼‰
â”‚   â””â”€â”€ .next/              # ç¼–è¯‘åçš„ä»£ç 
â”œâ”€â”€ static/                  # é™æ€èµ„æºï¼ˆéœ€è¦æ‰‹åŠ¨å¤åˆ¶ï¼‰
â”‚   â””â”€â”€ ...
```

**éƒ¨ç½²æ­¥éª¤**ï¼š
```bash
# 1. æ„å»º
npm run build

# 2. å¤åˆ¶å¿…è¦æ–‡ä»¶åˆ°éƒ¨ç½²ç›®å½•
mkdir -p deploy
cp -r .next/standalone/* deploy/
cp -r .next/static deploy/.next/
cp -r public deploy/

# 3. è¿›å…¥éƒ¨ç½²ç›®å½•
cd deploy

# 4. å¯åŠ¨åº”ç”¨
node server.js
```

**æ‰§è¡Œæ–¹å¼**ï¼š
```bash
# ç›´æ¥è¿è¡Œ
node server.js

# æŒ‡å®šç«¯å£å’Œä¸»æœº
PORT=8080 HOSTNAME=0.0.0.0 node server.js

# ä½¿ç”¨ PM2 ç®¡ç†
pm2 start server.js --name "ai-movie-maker"
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä½“ç§¯å°ï¼ˆåªåŒ…å«å¿…éœ€ä¾èµ–ï¼‰
- âœ… é€‚åˆ Docker éƒ¨ç½²
- âœ… å¯åŠ¨å¿«é€Ÿ
- âœ… ç”Ÿäº§ç¯å¢ƒæ¨è

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦æ‰‹åŠ¨å¤åˆ¶é™æ€æ–‡ä»¶

---

## ğŸ³ Docker éƒ¨ç½²ï¼ˆä½¿ç”¨ Standaloneï¼‰

### Dockerfile ç¤ºä¾‹
```dockerfile
# ç¬¬ä¸€é˜¶æ®µï¼šå®‰è£…ä¾èµ–
FROM node:20-alpine AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci --only=production

# ç¬¬äºŒé˜¶æ®µï¼šæ„å»ºåº”ç”¨
FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# ç¬¬ä¸‰é˜¶æ®µï¼šç”Ÿäº§è¿è¡Œ
FROM node:20-alpine AS runner
WORKDIR /app

ENV NODE_ENV=production
ENV PORT=3000
ENV HOSTNAME=0.0.0.0

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

CMD ["node", "server.js"]
```

### æ„å»ºå’Œè¿è¡Œ
```bash
# æ„å»ºé•œåƒ
docker build -t ai-movie-maker .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name ai-movie-maker \
  -p 3000:3000 \
  --env-file .env.production \
  --restart unless-stopped \
  ai-movie-maker

# æŸ¥çœ‹æ—¥å¿—
docker logs -f ai-movie-maker
```

---

## ğŸ“„ é™æ€å¯¼å‡ºæ¨¡å¼ï¼ˆStatic Exportï¼‰

### é€‚ç”¨åœºæ™¯
- âœ… çº¯é™æ€ç½‘ç«™ï¼ˆæ— æœåŠ¡ç«¯é€»è¾‘ï¼‰
- âœ… éƒ¨ç½²åˆ° CDNï¼ˆå¦‚ Cloudflare Pagesã€Netlifyï¼‰
- âŒ **ä¸æ”¯æŒ** API Routes
- âŒ **ä¸æ”¯æŒ** åŠ¨æ€è·¯ç”±ï¼ˆéœ€è¦é¢„ç”Ÿæˆï¼‰

### é…ç½®æ–¹å¼
ä¿®æ”¹ `next.config.js`ï¼š
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  output: 'export',          // é™æ€å¯¼å‡º
  trailingSlash: true,       // URL æœ«å°¾æ·»åŠ æ–œæ 
  images: {
    unoptimized: true,       // ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–ï¼ˆCDN ä¸æ”¯æŒï¼‰
  },
};

module.exports = nextConfig;
```

### æ„å»ºè¾“å‡º
```bash
npm run build
```

**è¾“å‡ºç›®å½•**ï¼š
```
out/                         # â­ é™æ€ HTML è¾“å‡º
â”œâ”€â”€ index.html              # é¦–é¡µ
â”œâ”€â”€ about.html              # å…¶ä»–é¡µé¢
â”œâ”€â”€ _next/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ static/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### éƒ¨ç½²æ–¹å¼
```bash
# éƒ¨ç½²åˆ°ä»»ä½•é™æ€æœåŠ¡å™¨
# Nginx
cp -r out/* /var/www/html/

# Cloudflare Pages
npx wrangler pages deploy out

# Netlify
netlify deploy --prod --dir=out
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨é™æ€ï¼ˆæ— éœ€ Node.jsï¼‰
- âœ… å¯éƒ¨ç½²åˆ° CDN
- âœ… æ€§èƒ½æœ€ä½³

**ç¼ºç‚¹**ï¼š
- âŒ ä¸æ”¯æŒ API Routes
- âŒ ä¸æ”¯æŒ SSR
- âŒ ä¸æ”¯æŒåŠ¨æ€è·¯ç”±

---

## ğŸš€ å„å¹³å°éƒ¨ç½²å‘½ä»¤

### Vercelï¼ˆæœ€ç®€å•ï¼‰
```bash
# å®‰è£… CLI
npm i -g vercel

# éƒ¨ç½²
vercel --prod
```
**æ— éœ€é…ç½®**ï¼ŒVercel è‡ªåŠ¨å¤„ç†æ„å»ºå’Œéƒ¨ç½²ã€‚

### Railway
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º railway.json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "npm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### PM2ï¼ˆä¼ ç»ŸæœåŠ¡å™¨ï¼‰
```bash
# ä½¿ç”¨æ ‡å‡†æ¨¡å¼
npm run build
pm2 start npm --name "ai-movie-maker" -- start

# ä½¿ç”¨ Standalone æ¨¡å¼
npm run build
cd .next/standalone
pm2 start server.js --name "ai-movie-maker"

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs ai-movie-maker
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### å¼€å‘ç¯å¢ƒï¼ˆ`.env.local`ï¼‰
```bash
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx
NEXT_PUBLIC_DASHSCOPE_API_KEY=xxx
```

### ç”Ÿäº§ç¯å¢ƒ

#### æ–¹å¼ 1ï¼šç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
# .env.production
NODE_ENV=production
PORT=3000
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
# ... å…¶ä»–å˜é‡
```

#### æ–¹å¼ 2ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡
```bash
# å¯¼å‡ºç¯å¢ƒå˜é‡
export NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
export PORT=8080

# å¯åŠ¨åº”ç”¨
npm start
```

#### æ–¹å¼ 3ï¼šVercel Dashboard
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½® **Environment Variables**ã€‚

---

## ğŸ“Š æ„å»ºæ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | æ ‡å‡†æ¨¡å¼ | Standalone | é™æ€å¯¼å‡º |
|------|---------|-----------|---------|
| API Routes | âœ… | âœ… | âŒ |
| SSR | âœ… | âœ… | âŒ |
| SSG | âœ… | âœ… | âœ… |
| åŠ¨æ€è·¯ç”± | âœ… | âœ… | éƒ¨åˆ† |
| é•œåƒä½“ç§¯ | å¤§ï¼ˆ~500MBï¼‰ | å°ï¼ˆ~150MBï¼‰ | æœ€å°ï¼ˆçº¯é™æ€ï¼‰ |
| éœ€è¦ Node.js | âœ… | âœ… | âŒ |
| éƒ¨ç½²å¤æ‚åº¦ | ä¸­ | ä½ | æœ€ä½ |
| æ€§èƒ½ | å¥½ | å¥½ | æœ€ä½³ |
| **æ¨èåœºæ™¯** | å¼€å‘/å°è§„æ¨¡ | **ç”Ÿäº§ç¯å¢ƒ** | çº¯é™æ€ç«™ |

---

## ğŸ¯ æ¨èé…ç½®

### å½“å‰é¡¹ç›®ï¼ˆAI Movie Makerï¼‰
ç”±äºé¡¹ç›®åŒ…å«ï¼š
- âœ… API Routesï¼ˆ`/api/*`ï¼‰
- âœ… æœåŠ¡ç«¯é€»è¾‘ï¼ˆSupabase Authï¼‰
- âœ… åŠ¨æ€å†…å®¹

**æ¨èä½¿ç”¨ Standalone æ¨¡å¼**ï¼š

```javascript
// next.config.js
module.exports = {
  reactStrictMode: true,
  output: 'standalone',
};
```

### éƒ¨ç½²å‘½ä»¤
```bash
# 1. æ„å»º
npm run build

# 2. éƒ¨ç½²ï¼ˆPM2ï¼‰
pm2 start .next/standalone/server.js \
  --name "ai-movie-maker" \
  --env production

# 3. ä¿å­˜é…ç½®
pm2 save
pm2 startup
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ‰¾ä¸åˆ° `.next/standalone` ç›®å½•ï¼Ÿ
**åŸå› **ï¼šæœªå¯ç”¨ `output: 'standalone'`ã€‚

**è§£å†³**ï¼šä¿®æ”¹ `next.config.js`ï¼Œæ·»åŠ  `output: 'standalone'`ã€‚

### 2. é™æ€èµ„æº 404ï¼Ÿ
**åŸå› **ï¼šStandalone æ¨¡å¼éœ€è¦æ‰‹åŠ¨å¤åˆ¶ `static` å’Œ `public`ã€‚

**è§£å†³**ï¼š
```bash
cp -r .next/static .next/standalone/.next/
cp -r public .next/standalone/
```

### 3. ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆï¼Ÿ
**åŸå› **ï¼š
- `NEXT_PUBLIC_*` å˜é‡åœ¨æ„å»ºæ—¶æ³¨å…¥ï¼Œéœ€è¦é‡æ–°æ„å»º
- é `NEXT_PUBLIC_*` å˜é‡åœ¨è¿è¡Œæ—¶æ³¨å…¥ï¼Œæ— éœ€é‡æ–°æ„å»º

**è§£å†³**ï¼š
```bash
# ä¿®æ”¹ NEXT_PUBLIC_* å˜é‡å
npm run build

# ä¿®æ”¹å…¶ä»–å˜é‡ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰
export DATABASE_URL=xxx
npm start  # æ— éœ€é‡æ–°æ„å»º
```

### 4. Docker é•œåƒå¤ªå¤§ï¼Ÿ
**åŸå› **ï¼šä½¿ç”¨äº†å®Œæ•´çš„ `node_modules`ã€‚

**è§£å†³**ï¼šä½¿ç”¨ Standalone æ¨¡å¼ + å¤šé˜¶æ®µæ„å»ºï¼ˆè§ä¸Šæ–¹ Dockerfileï¼‰ã€‚

---

## ğŸ“š å‚è€ƒèµ„æ–™
- [Next.js éƒ¨ç½²æ–‡æ¡£](https://nextjs.org/docs/deployment)
- [Standalone è¾“å‡ºæ¨¡å¼](https://nextjs.org/docs/advanced-features/output-file-tracing)
- [é™æ€å¯¼å‡º](https://nextjs.org/docs/app/building-your-application/deploying/static-exports)

