## 产品需求文档（AIMoverMaker）

### 1. 项目背景  
- 定位：面向创作者与营销人员的一体化 AIGC 画布工具，提供提示词生成图片与基于现有素材的二次生成能力。  
- 现状：已有目标界面原型（UI.png），需转化为可用的 MVP。  
- 价值：帮助用户快速落地创意图像，减少在多工具之间切换的成本。

### 2. 产品目标  
1. 通过提示词生成高质量图片，并支持基于选中元素的再次生成及相似图生成。  
2. 提供简洁、所见即所得的画布编辑体验，可自由排版生成/上传的图片与文字，支持多元素联动。  
3. 支持快速导出、保存和分享作品。

### 3. 用户画像  
- **主要用户**：电商设计师、自媒体运营者、内容营销团队。  
- **核心痛点**：需要快速产出风格统一的图像内容；频繁微调提示词；需要在画布上组合多素材。

### 4. 使用场景  
1. 用户输入提示词生成首张图片，并放置在画布上排版。  
2. 用户对选中图片使用「再次生成」尝试不同细节，或「类似图片生成」扩展同风格素材。  
3. 用户上传品牌素材，增加文字描述，导出图像用于发布。

### 5. 核心流程  
1. **项目创建**  
   - 打开应用 → 默认创建空白画布（单位 px，可设置背景色/网格）。  
   - 顶部左侧显示项目标题（默认为 Untitled，可编辑）。  
2. **生成图片**  
   - 底部输入框填写提示词 → 选择模式（首次生成或基于选中图片的修改）→ 调用虚拟数据 API → 返回图片自动添加到画布中央。  
3. **画布编辑**  
   - 拖拽、缩放、对齐；支持撤销/重做。  
   - 左侧工具栏可添加文字、上传图片等。  
4. **图像再生成与相似图**  
   - 选中单个图片 → 触发顶部悬浮操作栏 → 点击「再次生成」或「类似图片生成」→ 输入框填充原提示词，可编辑后执行 → 新图片替换或新增。  
5. **多选生成**  
   - 用户框选多个图片 → 底部输入框自动切换为“基于多图生成”模式 → 输入提示词 → 调用虚拟数据 API → 返回的新图片默认新增到画布。  
6. ** 图片下载 **  
   - 可以下载生成的图片

### 6. 功能需求明细  
#### 6.1 画布区域  
- 基于 React Flow 打造画布底层，节点代表画布元素，支持自定义节点样式与交互。  
- 支持放大缩小（0.5x~2x），支持网格背景开关。  
- 画布元素：图片、文本（后续可扩展形状）。  
- 元素操作：拖拽、缩放（保持比例）、旋转（若上线时需要，可延后）、删除。  
- 对齐辅助：拖拽时显示辅助线；提供对齐到中心/边缘的吸附。  
- 支持多选、组合、层级调整。  
- 快捷键：Delete 删除，Cmd/Ctrl+Z 撤销，Cmd/Ctrl+Shift+Z 重做（MVP 至少实现撤销/重做）。  

#### 6.2 顶部操作栏（选中图片时显示）  
- 悬浮于选中图片上方，显示按钮：  
  - `再次生成`：以当前选中图片关联的提示词再次调用生成接口，返回结果默认替换原图片；可在弹出的轻量输入框中修改提示词。  
  - `类似图片生成`：基于原图片与提示词生成相似风格图像，返回结果以新元素形式添加到画布（默认放在原图右侧）。  
  - `下载`：下载选中图片源文件。  
  - `删除`：从画布移除元素。  
- 未选中图片时不展示悬浮栏。  
- 多选情况下顶部操作栏显示“批量生成”入口，点击后调用底部输入框（多图模式）并聚焦。  

#### 6.3 左侧工具栏  
- 图标纵向排列，包含：  
  - `移动`：默认模式，操作画布元素。  
  - `文字`：点击后在画布中心放置文本框，默认文案“点击编辑文字”。  
  - `上传图片`：触发系统文件选择器，支持 JPG/PNG（<=10MB），上传成功后添加到画布。  
- 预留扩展位（可在后续增加背景、贴图等）。  

#### 6.4 底部 AI 输入面板  
- 输入框占据底部中间区域，上方提示“你想改变什么？”。  
- 支持纯文本提示词；后续可扩展负面词。  
- 行为根据上下文判断：  
  - 若无选中图片 → 调用“生成新图”接口。  
  - 若选中单个图片 → 输入框文案显示“编辑图片”，调用“再次生成”或“类似图片生成”接口（基于选项）。  
  - 若多选图片 → 输入框文案显示“基于 X 张图片生成”，调用“多图生成”接口，生成结果不覆盖原图。  
- 提供历史记录面板（MVP 可选后续迭代）。  

#### 6.5 多选与框选能力  
- 框选操作：拖拽框选区域，React Flow 自动选中框内节点。  
- 支持 Shift+点击 追加多个元素至选区。  
- 多选状态下允许统一移动、对齐、批量删除。  
- 触发批量生成时，将所选图片的元数据与提示词一并传入虚拟数据 API，返回结果列表逐一添加到画布。  

#### 6.6 项目管理与分享  
- 顶部：项目标题可编辑；右上角包含 `Share`（预留）与设置菜单。  
- 保存：MVP 支持本地自动保存（localStorage）；后续接入账号体系与云端存储。  
- 导出：点击导出后可选择导出画布 PNG、PNG 透明、JPEG；支持指定分辨率。  

### 7. AI 能力与后端接口  
- 模型：固定 `gemini-2.5-flash-image-preview`。  
- 模式：  
  1. `generate`：根据提示词生成新图片。  
  2. `edit`：基于已有图片+提示词进行修改或生成相似图片（用于顶部两按钮）。  
  3. `batch`：基于多张图片+提示词生成新图片集合。  
- 接口约定（示例）：  
  - `POST /api/images/generate`：参数 `prompt`, `mode`，返回 `imageUrl`, `promptId`.  
  - `POST /api/images/edit`：参数 `prompt`, `promptId` 或 `imageId`, `variationType`（`regenerate`/`similar`），返回新 `imageUrl`.  
  - `POST /api/images/batch`：参数 `prompt`, `imageIds[]`, 返回 `imageUrls[]`.  
- MVP 阶段前端使用虚拟数据模块模拟上述接口的响应与延迟；后端实现延后到下一阶段。  
- 后端最终负责调用 Gemini API、持久化 prompt 与图片元数据、返回可访问的临时链接。  

### 8. 数据结构（前端建议）  
- `canvasElements`: 数组存储元素对象 `{ id, type, src/text, position, size, promptId?, sourceImageIds? }`.  
- `promptsHistory`: 保存提示词与生成记录 `{ promptId, promptText, imageId, mode }`.  
- `selection`: 当前选中元素 ID 列表（支持多选）。  
- `batchGenerationContext`: 多选时缓存 `{ selectionIds, promptDraft, lastResultIds }`。  
- `apiMocks`: 统一的虚拟数据服务配置 `{ latency, fixtures }`。  
- `uiState`: 画布缩放、网格开关、侧边栏状态等。  

### 9. 非功能需求  
- 性能：常见画布元素数量 < 30 时保持流畅；接口响应目标 < 5s。  
- 兼容性：桌面端 Chrome / Edge / Safari 最新版。  
- 安全性：接口需校验请求来源；用户上传图片进行文件类型校验。  
- 隐私：遵守隐私政策，用户上传素材不用于模型训练（在条款中声明）。  

### 10. 指标与评估  
- 生成成功率 ≥ 95%。  
- 平均生成耗时 ≤ 8 秒。  
- 首次访问到完成第一张图片生成的时间（FTU） ≤ 2 分钟。  
- 日活用户中 ≥ 60% 使用「再次生成」或「类似图片生成」。  

### 11. 里程碑（MVP）  
1. **第 1 周**：项目初始化、界面框架、画布基础交互。  
2. **第 2 周**：AI 接口联调、顶部操作栏、上传与文字功能。  
3. **第 3 周**：导出能力、状态持久化、QA 与打磨。  
4. **第 4 周**：上线准备（部署、文档、埋点）。  

 

（版本：v0.1，2025-11-11）

