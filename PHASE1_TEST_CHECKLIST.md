# Phase 1: 连线菜单系统 - 测试清单

> 📅 测试日期: 2025-11-18  
> ✅ 构建状态: 成功  
> 📊 代码减少: 203 行 (13.4%)

---

## 🎯 重构成果

### 代码变化
- **Canvas.tsx**: 1515 行 → 1312 行 (-203 行, -13.4%)
- **新增文件**: 7 个
  - `types/connection-menu.ts` (类型定义)
  - `hooks/canvas/useConnectionMenu.ts` (状态管理 Hook)
  - `components/canvas/connection-menu/ConnectionMenuRoot.tsx` (根组件)
  - `components/canvas/connection-menu/ImageSubmenu.tsx` (图片子菜单)
  - `components/canvas/connection-menu/VideoSubmenu.tsx` (视频子菜单)
  - `components/canvas/connection-menu/ImagePromptInput.tsx` (提示词输入)

### 架构改进
- ✅ 连线菜单状态管理独立为 Hook
- ✅ 连线菜单 UI 拆分为 4 个独立组件
- ✅ 类型定义集中管理
- ✅ 0 TypeScript 错误
- ✅ 0 Linter 错误

---

## 🧪 测试场景

### 1. 文本节点 → 图片 (文生图)

**步骤**:
1. 创建文本节点
2. 从文本节点拉线到空白处
3. 选择"图片" → 选择比例（9:16 / 16:9 / 1:1）
4. 观察是否生成图片

**预期结果**:
- [x] 菜单正常显示
- [x] 子菜单正常显示
- [x] 图片生成流程正常
- [x] 连线动画正常
- [x] 图片节点正常显示

---

### 2. 文本节点 → 视频 (文生视频)

**步骤**:
1. 创建文本节点
2. 从文本节点拉线到空白处
3. 选择"视频" → 选择比例（9:16 / 16:9）
4. 观察是否生成视频

**预期结果**:
- [x] 菜单正常显示
- [x] 子菜单正常显示
- [x] 视频生成流程正常
- [x] 连线动画正常
- [x] 视频节点正常显示

---

### 3. 图片节点 → 图片 (图生图)

**步骤**:
1. 创建或上传图片节点
2. 从图片节点拉线到空白处
3. 选择"图片" → 选择比例 → 输入提示词
4. 观察是否生成新图片

**预期结果**:
- [x] 菜单正常显示
- [x] 比例选择正常
- [x] 提示词输入框正常显示
- [x] 输入框自动聚焦
- [x] Enter 键提交正常
- [x] Escape 键返回正常
- [x] 占位符节点正常显示
- [x] 用户输入提示词后生成图片

---

### 4. 图片节点 → 视频 (图生视频)

**步骤**:
1. 创建或上传图片节点
2. 从图片节点拉线到空白处
3. 选择"视频" → 选择比例（9:16 / 16:9）
4. 观察是否创建视频节点

**预期结果**:
- [x] 菜单正常显示
- [x] 子菜单正常显示
- [x] 视频节点正常创建
- [x] 连线正常连接

---

### 5. 视频节点 → 文本节点 (提示词)

**步骤**:
1. 创建视频节点
2. 从视频节点的"prompt-text"手柄拉线到空白处
3. 观察是否自动创建文本节点

**预期结果**:
- [x] 不显示菜单（直接创建）
- [x] 文本节点正常创建
- [x] 文本内容为视频的提示词
- [x] 连线正常连接

---

### 6. 菜单交互测试

**步骤**:
1. 测试菜单的"返回"按钮
2. 测试点击外部关闭菜单
3. 测试快速连续拉线

**预期结果**:
- [x] "返回"按钮正常工作
- [x] 点击外部可以关闭菜单
- [x] 快速拉线不会出现多个菜单
- [x] 菜单位置正确（鼠标位置）

---

### 7. 边缘情况测试

**步骤**:
1. 测试从节点拉线到另一个节点（不是空白处）
2. 测试在没有完成连线时进行其他操作
3. 测试图生图时不输入提示词直接确认

**预期结果**:
- [x] 拉线到节点时菜单不显示
- [x] 未完成连线时菜单正常关闭
- [x] 未输入提示词时提示用户

---

## ✅ 测试结果

### 通过的测试
- [ ] 文本节点 → 图片
- [ ] 文本节点 → 视频
- [ ] 图片节点 → 图片
- [ ] 图片节点 → 视频
- [ ] 视频节点 → 文本节点
- [ ] 菜单交互
- [ ] 边缘情况

### 发现的问题
_（记录测试中发现的问题）_

---

## 📝 后续步骤

如果所有测试通过：
1. ✅ 提交 Phase 1 的代码
2. 📝 更新 todolist.md
3. 🚀 开始 Phase 2: 图片生成逻辑拆分

---

> 💡 **提示**: 请在本地运行 `npm run dev` 并手动测试所有场景。

